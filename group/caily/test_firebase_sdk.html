<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase SDK Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Firebase SDK Loading Test</h1>
    
    <div id="status">Testing Firebase SDK loading...</div>
    <div id="logs"></div>
    
    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = type;
            statusDiv.textContent = message;
        }
        
        async function testFirebaseSDK() {
            try {
                log('Starting Firebase SDK test...');
                
                // Test 1: Load Firebase App SDK
                log('Loading Firebase App SDK...');
                await loadScript('https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js');
                log('✅ Firebase App SDK loaded successfully', 'success');
                
                // Test 2: Check if firebase object exists
                if (typeof firebase === 'undefined') {
                    throw new Error('firebase object is not defined after loading App SDK');
                }
                log('✅ firebase object is available', 'success');
                
                // Test 3: Load Firebase Database SDK
                log('Loading Firebase Database SDK...');
                await loadScript('https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js');
                log('✅ Firebase Database SDK loaded successfully', 'success');
                
                // Test 4: Check if database is available
                if (typeof firebase.database === 'undefined') {
                    throw new Error('firebase.database is not defined after loading Database SDK');
                }
                log('✅ firebase.database is available', 'success');
                
                // Test 5: Test initialization with mock config
                log('Testing Firebase initialization...');
                const mockConfig = {
                    apiKey: "test",
                    authDomain: "test.firebaseapp.com",
                    projectId: "test",
                    storageBucket: "test.appspot.com",
                    messagingSenderId: "123",
                    appId: "1:123:web:test",
                    databaseURL: "https://test-default-rtdb.firebaseio.com"
                };
                
                try {
                    const app = firebase.initializeApp(mockConfig);
                    log('✅ Firebase initialization successful', 'success');
                    
                    // Test 6: Test database reference
                    const db = firebase.database();
                    const ref = db.ref('test');
                    log('✅ Database reference created successfully', 'success');
                    
                    updateStatus('✅ All Firebase SDK tests passed!', 'success');
                    
                } catch (initError) {
                    log('⚠️ Firebase initialization failed (expected with mock config): ' + initError.message, 'error');
                    log('This is normal with mock configuration', 'info');
                    updateStatus('✅ Firebase SDK loading successful (initialization test skipped)', 'success');
                }
                
            } catch (error) {
                log('❌ Firebase SDK test failed: ' + error.message, 'error');
                updateStatus('❌ Firebase SDK test failed', 'error');
            }
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => resolve();
                script.onerror = (e) => reject(new Error(`Failed to load ${src}: ${e.message}`));
                document.head.appendChild(script);
            });
        }
        
        // Alternative SDK versions to test
        async function testAlternativeVersions() {
            const versions = [
                '9.22.0',
                '9.0.0',
                '8.10.1'
            ];
            
            log('Testing alternative Firebase SDK versions...');
            
            for (const version of versions) {
                try {
                    log(`Testing version ${version}...`);
                    
                    // Clear previous scripts
                    const existingScripts = document.querySelectorAll('script[src*="firebasejs"]');
                    existingScripts.forEach(script => script.remove());
                    
                    // Reset firebase object
                    delete window.firebase;
                    
                    // Load new version
                    await loadScript(`https://www.gstatic.com/firebasejs/${version}/firebase-app-compat.js`);
                    await loadScript(`https://www.gstatic.com/firebasejs/${version}/firebase-database-compat.js`);
                    
                    if (typeof firebase !== 'undefined' && typeof firebase.database !== 'undefined') {
                        log(`✅ Version ${version} works!`, 'success');
                        return version;
                    }
                    
                } catch (error) {
                    log(`❌ Version ${version} failed: ${error.message}`, 'error');
                }
            }
            
            throw new Error('No Firebase SDK version worked');
        }
        
        // Run tests
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await testFirebaseSDK();
            } catch (error) {
                log('Primary test failed, trying alternative versions...', 'info');
                try {
                    const workingVersion = await testAlternativeVersions();
                    log(`Found working version: ${workingVersion}`, 'success');
                    updateStatus(`✅ Firebase SDK working with version ${workingVersion}`, 'success');
                } catch (altError) {
                    log('All Firebase SDK versions failed', 'error');
                    updateStatus('❌ All Firebase SDK versions failed', 'error');
                }
            }
        });
    </script>
</body>
</html> 